<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#A10054" />
  <title>Hitachi Axis 4 — TWA Full-Screen Demo (v1.0.1)</title>

  <style>
    html, body {
      touch-action: pan-x pan-y;
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    *, *::before, *::after { box-sizing: border-box }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      color: #0e0e0e;
      background: #fafafa;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    :root {
      --axis:#A10054; --hitachi:#E60012; --ink:#111827; --muted:#6b7280;
      --bg:#f8fafc; --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.06), 0 2px 10px rgba(0,0,0,.04);
      --radius:20px;
    }

    @media (prefers-color-scheme: dark){
      body{background:#0b0b0c;color:#e5e7eb}
      :root{--bg:#0b0b0c;--card:#0f1115;--ink:#e5e7eb;--muted:#9ca3af;--shadow:0 10px 30px rgba(0,0,0,.4), 0 2px 10px rgba(0,0,0,.35)}
    }

    .safe{padding:env(safe-area-inset-top,0) env(safe-area-inset-right,0) env(safe-area-inset-bottom,0) env(safe-area-inset-left,0)}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    .grid{display:grid;gap:20px}

    header{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--axis),var(--hitachi));color:#fff;box-shadow:var(--shadow)}
    .topbar{display:flex;align-items:center;justify-content:space-between;height:64px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700}
    nav.actions{display:flex;gap:10px}
    .btn{appearance:none;border:0;border-radius:999px;padding:10px 16px;font-weight:600;cursor:pointer}
    .btn.solid{background:#fff;color:#111}
    .btn.ghost{background:rgba(255,255,255,.16);color:#fff}
    .btn.outline{background:transparent;color:var(--axis);outline:2px solid rgba(161,0,84,.3)}
    .btn.primary{background:var(--axis);color:#fff}

    .hero{min-height:calc(100svh - 64px);display:grid;place-items:center;background:
      radial-gradient(1200px 500px at 10% -10%, rgba(255,255,255,.25), transparent 60%),
      radial-gradient(1200px 600px at 110% -20%, rgba(255,255,255,.15), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0));
      backdrop-filter:saturate(1.15)
    }
    .hero .card{display:grid;gap:22px;background:var(--card);padding:28px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .pill{display:inline-flex;align-items:center;gap:8px;font-weight:700;color:var(--axis);background:rgba(161,0,84,.08);padding:8px 12px;border-radius:999px}
    header .pill { color:#fff;background:rgba(255,255,255,.16) }

    .title{font-size:clamp(24px,4vw,42px);line-height:1.1;margin:0;color:var(--ink)}
    .subtitle{margin:0;color:var(--muted)}
    .cta{display:flex;flex-wrap:wrap;gap:12px}

    .features{padding:40px 0}
    .cards{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .card{background:var(--card);border-radius:16px;padding:20px;box-shadow:var(--shadow)}
    .card h3{margin:.2rem 0 .4rem;font-size:1.05rem}
    .card p{margin:0;color:var(--muted)}
    .tag{font-size:12px;display:inline-flex;gap:8px;align-items:center;color:#fff;background:var(--axis);padding:6px 10px;border-radius:999px}

    .muted{color:var(--muted)}
    .field{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(0,0,0,.12);background:var(--card);color:inherit}
    .file-row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:12px}
    .file-name{font-size:.95rem}

    #printArea{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:12px;min-height:120px;display:grid;place-items:center;overflow:hidden}
    #printArea > .placeholder{padding:28px;color:var(--muted)}
    #printArea img{max-width:100%;height:auto;display:block}
    #printArea iframe{width:100%;height:500px;border:0}
    #printArea pre{margin:0;padding:16px;white-space:pre-wrap;word-break:break-word;width:100%}

    footer{padding:40px 0;color:var(--muted)}
    .legal{font-size:12px;opacity:.8}

    .toast{position:fixed;left:50%;bottom:calc(env(safe-area-inset-bottom,0) + 20px);
      transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;
      border-radius:999px;box-shadow:var(--shadow);opacity:0;transition:opacity .25s, transform .25s;
      pointer-events:none}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-4px)}

    /* Page print */
    @media print {
      body { margin:0 }
      header, .hero, footer, nav.actions, .toast { display: none !important; }
      @page { margin: 1cm; }
    }
  </style>
</head>

<body class="safe">
  <header class="safe">
    <div class="container topbar">
      <div class="brand" aria-label="Hitachi Axis">
        <span class="pill">Hitachi Axis</span>
        <small style="opacity:.85;margin-left:8px">Digital Banking</small>
        <small style="opacity:.6;margin-left:6px">(v1.0.1)</small>
      </div>

      <nav class="actions" aria-label="Primary">
        <button class="btn ghost" onclick="scrollToId('products')">Products</button>
        <button class="btn ghost" onclick="scrollToId('features')">Features</button>
        <button class="btn solid" onclick="primaryCTA()">Open Account</button>
        <button class="btn solid" onclick="printPage()">Print Page</button>
      </nav>
    </div>
  </header>

  <main>
    <!-- (your entire existing hero, features, products, contact sections remain unchanged) -->
    <!-- Upload & Print -->
    <section id="uploadSection" class="safe">
      <div class="container">
        <div class="card">
          <h2 style="margin:0 0 10px">Upload & Print</h2>
          <p class="muted" style="margin:0 0 12px">Choose an image, PDF, or text file. “Print Uploaded” prints the image only.</p>

          <div class="file-row">
            <input id="fileInput" type="file" class="field" accept="image/*,application/pdf,text/plain" />
            <button class="btn primary" onclick="printUploaded()">Print Uploaded</button>
            <button class="btn outline" onclick="generatePdf()">Generate PDF</button>
            <span id="fileName" class="file-name muted"></span>
          </div>

          <div id="printArea">
            <div class="placeholder">No file selected yet.</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="safe">
    <div class="container">
      <div class="row" style="justify-content:space-between;gap:10px">
        <span>© <span id="year"></span> Hitachi Axis (Demo)</span>
        <span class="legal">For TWA preview only.</span>
      </div>
    </div>
  </footer>

  <script src="jspdf.umd.min.js?v=1.0.1"></script>
  <script>
    const APP_VERSION = "1.0.1";

    // Helpers
    function toaster(msg){
      let t=document.querySelector('.toast');
      if(!t){t=document.createElement('div');t.className='toast';document.body.appendChild(t)}
      t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1800);
    }
    function scrollToId(id){document.getElementById(id)?.scrollIntoView({behavior:'smooth',block:'start'});}
    function printPage(){toaster('Opening print dialog...');window.print();}
    document.getElementById('year').textContent=new Date().getFullYear();

    // File handling
    const fileInput=document.getElementById('fileInput');
    const fileNameEl=document.getElementById('fileName');
    const printArea=document.getElementById('printArea');
    let lastDataUrl=null;

    fileInput.addEventListener('change',async e=>{
      const file=e.target.files?.[0];
      printArea.innerHTML='';
      fileNameEl.textContent='';
      lastDataUrl=null;

      if(!file){printArea.innerHTML='<div class="placeholder">No file selected yet.</div>';return;}

      fileNameEl.textContent=file.name;
      const type=file.type||'';
      const url=URL.createObjectURL(file);

      if(type.startsWith('image/')){
        const img=new Image();
        img.src=url; img.alt=file.name;
        img.onload=()=>{
          const c=document.createElement('canvas');
          c.width=img.naturalWidth||img.width;
          c.height=img.naturalHeight||img.height;
          c.getContext('2d',{alpha:false}).drawImage(img,0,0);
          lastDataUrl=c.toDataURL('image/png');
        };
        printArea.appendChild(img);
        toaster('Image ready for print');
        return;
      }
      if(type==='application/pdf'){
        const iframe=document.createElement('iframe');
        iframe.src=url;
        printArea.appendChild(iframe);
        toaster('PDF preview shown');
        return;
      }
      if(type==='text/plain'||file.name.endsWith('.txt')){
        const text=await file.text();
        const pre=document.createElement('pre');
        pre.textContent=text;
        printArea.appendChild(pre);
        toaster('Text preview shown');
        return;
      }
      const info=document.createElement('div');
      info.className='placeholder';
      info.textContent='Unsupported file type. Try image, PDF, or text.';
      printArea.appendChild(info);
    });

    // Reliable print flow
    function getPrintFrame(){
      let f=document.getElementById('__printFrame');
      if(!f){
        f=document.createElement('iframe');
        f.id='__printFrame';
        f.style.position='fixed';
        f.style.right='0';f.style.bottom='0';f.style.width='1px';f.style.height='1px';
        f.style.border='0';f.style.opacity='0';
        document.body.appendChild(f);
      }
      return f;
    }

    async function printUploaded(){
      const srcImg=document.querySelector('#printArea img');
      if(!srcImg){toaster('Please upload an image first.');return;}
      let dataUrl;
      try{
        if(srcImg.decode){try{await srcImg.decode();}catch{}}
        const c=document.createElement('canvas');
        c.width=srcImg.naturalWidth||srcImg.width||1;
        c.height=srcImg.naturalHeight||srcImg.height||1;
        const ctx=c.getContext('2d',{alpha:false});
        ctx.drawImage(srcImg,0,0);
        dataUrl=c.toDataURL('image/png');
      }catch(e){
        toaster('Error preparing image');return;
      }

      const frame=getPrintFrame();
      const doc=frame.contentDocument||frame.contentWindow.document;
      doc.open();
      doc.write(`
        <!doctype html><html><head>
        <meta charset="utf-8">
        <style>
        @page { size: A4; margin:0 }
        html,body{margin:0;padding:0;width:100%;height:100%}
        .page{width:100%;height:100%;display:grid;place-items:center}
        img{max-width:100%;max-height:100%;object-fit:contain;
        -webkit-print-color-adjust:exact;print-color-adjust:exact}
        </style></head><body>
        <div class="page"><img id="toPrint" alt="print"></div>
        </body></html>
      `);
      doc.close();

      await new Promise(res=>{
        if(frame.contentDocument?.readyState==='complete')res();
        else frame.onload=res;
      });

      const img=doc.getElementById('toPrint');
      await new Promise((res,rej)=>{
        img.onload=res;img.onerror=rej;img.src=dataUrl;
      });
      if(img.decode){try{await img.decode();}catch{}}
      await new Promise(r=>requestAnimationFrame(()=>requestAnimationFrame(r)));
      try{frame.contentWindow.print();}catch{}
      toaster('Sent to print');
    }

    // Optional PDF generation fallback
    async function generatePdf(){
      if(!lastDataUrl){toaster('Upload an image first');return;}
      const {jsPDF}=window.jspdf;
      const pdf=new jsPDF({unit:'pt',format:'a4'});
      const w=pdf.internal.pageSize.getWidth();
      const h=pdf.internal.pageSize.getHeight();
      const img=new Image();
      await new Promise((res,rej)=>{img.onload=res;img.onerror=rej;img.src=lastDataUrl;});
      const iw=img.naturalWidth,ih=img.naturalHeight;
      const scale=Math.min(w/iw,h/ih);
      const nw=iw*scale,nh=ih*scale;
      const x=(w-nw)/2,y=(h-nh)/2;
      pdf.addImage(lastDataUrl,'PNG',x,y,nw,nh);
      const filename=`print_image_${Date.now()}_v${APP_VERSION}.pdf`;
      pdf.save(filename);
      toaster('PDF generated');
    }
  </script>

  <div class="toast" aria-live="polite"></div>
</body>
</html>
